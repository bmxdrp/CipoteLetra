---
import sgMail from '@sendgrid/mail';
sgMail.setApiKey(import.meta.env.SENDGRID_API_KEY);
if (Astro.request.method === 'POST') {
    const data = await Astro.request.formData();
    const name = data.get('name');
    const email = data.get('email');
    const message = data.get('message');
    const msg = {
      to: 'cipoteletra@gmail.com', 
      from: 'cipoteletra@hotmail.com',
      replyTo: {email:email, name:name},
      subject: `Mensaje de ${name} desde Cipote Letra`,
      text: message,
    }
  
  await sgMail.send(msg as any)
  .then(() => {
    console.log('Email sent')
  })
  .catch((error) => {
    console.error(error)
  })
}
---
<script type="text/javascript">
  window.location.replace(`/contact?success=true`);
</script>